<!DOCTYPE html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <title>TV Valgte Kandidater</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #00407a;
        color: white;
        font-family: "Segoe UI", Roboto, Oxygen, Ubuntu, "Open Sans", sans-serif;
        width: 1920px;
        height: 1080px;
      }

      .container {
        width: 1920px;
        height: 1080px;
        position: relative;
        display: flex;
        flex-direction: column;
        z-index: 5;
      }

      .header {
        height: 140px;
        background-color: #003366;
        padding: 20px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 4px solid #0085c7;
        z-index: 20;
        position: relative;
      }

      .header-left {
        display: flex;
        align-items: center;
      }

      .title-box {
        background-color: #0085c7;
        padding: 15px 30px;
        border-radius: 8px;
        margin-right: 20px;
      }

      h1 {
        margin: 0;
        font-size: 48px;
        font-weight: bold;
      }
      h2 {
        margin: 0;
        font-size: 36px;
        font-weight: bold;
      }
      .subtitle {
        font-size: 28px;
      }

      .content {
        flex: 1;
        padding: 30px 40px;
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
      }

      .info-box {
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 15px 30px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
      }

      .footer {
        height: 80px;
        background-color: #002244;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 40px;
        font-size: 22px;
        z-index: 20;
        position: relative;
      }

      .opdateret {
        opacity: 0.8;
      }
      .nedtaelling {
        opacity: 0.8;
        font-size: 20px;
        margin-top: 4px;
        display: flex;
        align-items: center;
      }

      .update-icon {
        width: 16px;
        height: 16px;
        display: inline-block;
        margin-right: 8px;
        opacity: 0.5;
        transition: all 0.5s ease;
      }

      .update-icon.pulse {
        opacity: 1;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(1);
        }
      }

      .loading {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 64, 122, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 40px;
        z-index: 100;
      }

      .spinner {
        display: inline-block;
        width: 80px;
        height: 80px;
        margin-right: 20px;
        animation: spin 2s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      #fadeOverlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.7s ease-in-out;
        z-index: 90;
      }

      /* Data opdatering effekter */
      .update-flash {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        opacity: 0;
        pointer-events: none;
        z-index: 30;
        transition: opacity 0.7s ease-in-out;
      }

      /* Kommuneskift effekter */
      #transitionOverlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 80;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
      }

      .kommune-transition {
        font-size: 72px;
        font-weight: bold;
        background-color: rgba(0, 0, 0, 0.7);
        padding: 30px 60px;
        border-radius: 20px;
        border: 4px solid #0085c7;
        transform: scale(0.8);
        opacity: 0;
        transition: all 0.8s ease-in-out;
      }

      .optalt-indikator {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 5px;
        margin-left: 10px;
        font-size: 18px;
        font-weight: normal;
        transition: background-color 0.3s;
      }

      .optalt-indikator.fuldt {
        background-color: #1eaa5c;
      }

      .optalt-indikator.delvist {
        background-color: #f0ad4e;
      }

      .optalt-indikator.minimalt {
        background-color: #d9534f;
      }

      /* Valgte kandidater styling */
      .kandidat-container {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        padding: 0 10px;
        overflow-y: auto;
        height: 100%;
        align-content: flex-start;
      }

      .parti-gruppe {
        width: 440px;
        margin-bottom: 30px;
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.5s ease-out forwards;
      }

      .parti-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 10px 15px;
      }

      .parti-bogstav {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        font-weight: bold;
        margin-right: 15px;
        text-transform: uppercase;
      }

      .parti-navn {
        font-size: 20px;
        font-weight: bold;
      }

      .parti-mandater {
        margin-left: auto;
        background-color: rgba(255, 255, 255, 0.2);
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 16px;
      }

      .kandidat {
        display: flex;
        align-items: center;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 10px;
        transition: all 0.3s ease;
      }

      .kandidat:hover {
        background-color: rgba(255, 255, 255, 0.2);
      }

      .kandidat-foto {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        margin-right: 15px;
        background-size: cover;
        background-position: center;
        border: 2px solid white;
        background-color: #444;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        color: #ccc;
      }

      .kandidat-info {
        flex: 1;
      }

      .kandidat-navn {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .kandidat-detaljer {
        font-size: 14px;
        opacity: 0.8;
      }

      .kandidat-stemmer {
        font-weight: bold;
        background-color: rgba(255, 255, 255, 0.15);
        padding: 4px 8px;
        border-radius: 4px;
        margin-left: 15px;
        min-width: 70px;
        text-align: right;
      }

      /* Borgmester fremhævning */
      .kandidat.borgmester {
        border: 2px solid gold;
        background-color: rgba(255, 215, 0, 0.1);
        position: relative;
      }

      .kandidat.borgmester::after {
        content: "Borgmester";
        position: absolute;
        top: -10px;
        right: 10px;
        background-color: gold;
        color: black;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: bold;
      }

      @keyframes fadeInUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Video baggrund */
      .video-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        overflow: hidden;
      }

      .video-background video {
        position: absolute;
        min-width: 100%;
        min-height: 100%;
        width: auto;
        height: auto;
        z-index: -1;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        object-fit: cover;
      }

      /* Tilføj en overlayeffekt for bedre læsbarhed */
      .video-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(
          0,
          64,
          122,
          0.85
        ); /* Justér opacity efter behov */
        z-index: 2;
      }

      /* Stilarter for CasparCG-metadata */
      .meta {
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- CasparCG metadata (ikke synligt) -->
    <div id="meta" class="meta"></div>

    <!-- Video baggrund -->
    <div class="video-background">
      <div class="video-overlay"></div>
      <video autoplay muted loop playsinline>
        <source
          src="https://assets.nord.bazo.dk/video/290922_fv_loop_v1.mp4"
          type="video/mp4"
        />
      </video>
    </div>

    <div class="container">
      <div id="loadingScreen" class="loading">
        <div class="spinner">⟳</div>
        Indlæser kandidatdata...
      </div>

      <div class="header">
        <div class="header-left">
          <div class="title-box"><h1>KV21</h1></div>
          <h2>Valgte Kandidater</h2>
        </div>
        <div class="header-right">
          <h2 id="kommuneNavn">Kommune</h2>
          <span id="optaltIndikator" class="optalt-indikator fuldt"
            >Optalt</span
          >
        </div>
      </div>

      <div class="content">
        <div class="info-box">
          <div id="mandatInfo" class="subtitle">31 pladser i byrådet</div>
          <div id="kandidatInfo" class="subtitle">31 valgte kandidater</div>
        </div>

        <div id="kandidatContainer" class="kandidat-container">
          <!-- Kandidater indsættes her -->
        </div>
      </div>

      <div class="footer">
        <div id="mandater">Kommunalvalg 2021</div>
        <div>
          <div id="opdateretTid" class="opdateret">
            Sidst opdateret: --:--:--
          </div>
          <div id="nedtaelling" class="nedtaelling">
            <svg
              class="update-icon"
              viewBox="0 0 24 24"
              fill="currentColor"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M17.65 6.35C16.2 4.9 14.21 4 12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C15.73 20 18.84 17.45 19.73 14H17.65C16.83 16.33 14.61 18 12 18C8.69 18 6 15.31 6 12C6 8.69 8.69 6 12 6C13.66 6 15.14 6.69 16.22 7.78L13 11H20V4L17.65 6.35Z"
              />
            </svg>
            Opdaterer om: 30 sek
          </div>
        </div>
      </div>

      <!-- Visuelle effekter for overgange -->
      <div id="fadeOverlay"></div>
      <div id="updateFlash" class="update-flash"></div>
      <div id="transitionOverlay">
        <div id="kommuneTransition" class="kommune-transition"></div>
      </div>
    </div>

    <script>
      // Partifarvemapping
      const partiFarver = {
        A: "#e4002b", // Socialdemokratiet
        B: "#0085c7", // Radikale Venstre
        C: "#00a95c", // Konservative
        D: "#f58220", // Nye Borgerlige
        E: "#0085ca", // Klaus Riskær
        F: "#d71440", // SF
        G: "#005221", // Veganerpartiet
        I: "#ffc20e", // Liberal Alliance
        K: "#004b87", // Kristendemokraterne
        L: "#2cac2a", // Lokallisterne (generisk)
        M: "#522d80", // Moderaterne
        O: "#e3006e", // Dansk Folkeparti
        P: "#099d84", // Stram Kurs
        Q: "#7bc143", // Frie Grønne
        V: "#1e1e1e", // Venstre
        Ø: "#c00", // Enhedslisten
        Å: "#6a0dad", // Alternativet
      };

      // Tilføj små bogstaver-varianter
      Object.keys(partiFarver).forEach(
        (k) => (partiFarver[k.toLowerCase()] = partiFarver[k])
      );

      // Hjælpefunktion til at hente farve for et partibogstav
      const farve = (bogstav) => partiFarver[bogstav] || "#888";

      // Hent kommune-id fra URL-parameter
      let kommuneId =
        new URLSearchParams(window.location.search).get("id") || "851";
      let lastData = null;
      let cacheKey = Date.now(); // For at undgå cache ved API-kald
      let kommuneData = null; // Til at holde data fra første endpoint

      // Hjælpefunktion til at få fat i elementer
      const el = (id) => document.getElementById(id);

      /**
       * Formater tal med tusindtalsseparator
       */
      function formatNumber(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      }

      /**
       * Hent kommunedata fra results endpointet
       */
      async function hentKommuneData() {
        try {
          const url = `https://election-api.services.tv2.dk/kv/kv21/results/${kommuneId}?_cb=${cacheKey}`;
          const res = await fetch(url);

          if (!res.ok) {
            throw new Error(
              `Server returnerede ${res.status}: ${res.statusText}`
            );
          }

          const data = await res.json();
          console.log("Kommunedata modtaget:", data);

          kommuneData = data;
          return data;
        } catch (err) {
          console.error("Fejl ved hentning af kommunedata:", err);
          return null;
        }
      }

      /**
       * Hent kandidatdata fra TV2's API
       */
      async function hentKandidatData(visLoadingScreen = true) {
        if (visLoadingScreen) {
          el("loadingScreen").style.display = "flex";
        }

        try {
          // Hent først kommunedata
          await hentKommuneData();

          // Derefter hent kandidatdata
          const url = `https://election-api.services.tv2.dk/kv/kv21/areastatus/${kommuneId}?_cb=${cacheKey}`;
          const res = await fetch(url);

          if (!res.ok) {
            throw new Error(
              `Server returnerede ${res.status}: ${res.statusText}`
            );
          }

          const data = await res.json();
          console.log("Kandidatdata modtaget:", data);

          // Gem som sidste data
          lastData = data;

          // Gem metadata til CasparCG hvis det bruges
          gemCasparCGMetadata(data);

          // Vis data på siden
          visKandidatData(data);

          // Opdater cache-key til næste kald
          cacheKey = Date.now();
        } catch (err) {
          console.error("Fejl ved hentning af data:", err);
          el("kommuneNavn").textContent = "DATAFEJL";
          el("loadingScreen").innerHTML = `
            <div class="spinner">⟳</div>
            Fejl ved hentning af data: ${err.message}<br>
            Prøver igen om få sekunder...
          `;

          // Genindlæs siden om 10 sekunder ved fejl
          setTimeout(() => {
            location.reload();
          }, 10000);
        }
      }

      /**
       * Gem metadata i en skjult div til CasparCG
       */
      function gemCasparCGMetadata(data) {
        const meta = {
          kommuneId: kommuneId,
          kommuneNavn: kommuneData?.result?.name || data.name || "",
          antalKandidater:
            data.elected?.flatMap((p) => p.candidates)?.length || 0,
          antalMandater: kommuneData?.result?.seats || 0,
          optalingsProcent: kommuneData?.result?.electionProgress || 0,
          opdateret: data.lastUpdated || "",
        };

        el("meta").setAttribute("data-json", JSON.stringify(meta));
      }

      /**
       * Vis transitionseffekt ved kommuneskift
       */
      function visKommuneTransition(kommuneNavn) {
        const transitionDiv = el("transitionOverlay");
        const kommuneTransition = el("kommuneTransition");

        // Sæt kommunenavn
        kommuneTransition.textContent = kommuneNavn;

        // Vis overlay
        transitionDiv.style.opacity = "1";

        // Start animation
        setTimeout(() => {
          kommuneTransition.style.opacity = "1";
          kommuneTransition.style.transform = "scale(1)";
        }, 100);

        // Skjul efter animation
        setTimeout(() => {
          kommuneTransition.style.opacity = "0";
          kommuneTransition.style.transform = "scale(1.2)";

          setTimeout(() => {
            transitionDiv.style.opacity = "0";
            setTimeout(() => {
              kommuneTransition.style.transform = "scale(0.8)";
            }, 700);
          }, 800);
        }, 2000);
      }

      /**
       * Vis data opdateringseffekt
       */
      function visDataUpdateEffect() {
        const updateFlash = el("updateFlash");
        updateFlash.style.opacity = "0.3";

        setTimeout(() => {
          updateFlash.style.opacity = "0";
        }, 700);
      }

      /**
       * Vis kandidatdata på siden
       */
      function visKandidatData(data) {
        // Kommune navn fra kommunedata hvis tilgængelig, ellers fra kandidatdata
        const kommuneNavn =
          kommuneData?.result?.name || data.name || "Ukendt kommune";
        el("kommuneNavn").textContent = kommuneNavn;

        // Håndter optællingsindikator
        const optaltIndikator = el("optaltIndikator");
        const pct = kommuneData?.result?.electionProgress || 100;

        // Sæt optællingsprocent og klasse afhængigt af status
        optaltIndikator.textContent = `${pct}% optalt`;
        optaltIndikator.className = "optalt-indikator";

        if (pct >= 95) {
          optaltIndikator.classList.add("fuldt");
        } else if (pct >= 50) {
          optaltIndikator.classList.add("delvist");
        } else {
          optaltIndikator.classList.add("minimalt");
        }

        // Opdater info om byråd
        const antalMandater =
          kommuneData?.result?.seats || data.councilSeats || 31;
        el("mandatInfo").textContent = `${antalMandater} pladser i byrådet`;

        // Antal valgte kandidater
        const valgte = data.elected || [];
        const antalKandidater = valgte.flatMap((p) => p.candidates).length;
        el("kandidatInfo").textContent = `${antalKandidater} valgte kandidater`;

        // Ryd kandidat container
        const container = el("kandidatContainer");
        container.innerHTML = "";

        // Sorter partier efter antal mandater
        const sorteredePartier = [...valgte].sort(
          (a, b) => (b.candidates?.length || 0) - (a.candidates?.length || 0)
        );

        // Opret elementer for hvert parti
        sorteredePartier.forEach((parti, i) => {
          if (!parti.candidates || parti.candidates.length === 0) return;

          const partiLetter =
            parti.letter || parti.candidates[0]?.partyLetter || "";
          const partiNavn =
            parti.name || parti.candidates[0]?.partyName || "Ukendt parti";
          const partiColor = farve(partiLetter);
          const antalMandater = parti.candidates.length;

          // Opret parti-gruppe
          const partiGruppe = document.createElement("div");
          partiGruppe.className = "parti-gruppe";
          partiGruppe.style.animationDelay = `${i * 150}ms`;

          // Opret parti-header
          const partiHeader = document.createElement("div");
          partiHeader.className = "parti-header";
          partiHeader.innerHTML = `
            <div class="parti-bogstav" style="background-color: ${partiColor}">${partiLetter}</div>
            <div class="parti-navn">${partiNavn}</div>
            <div class="parti-mandater">${antalMandater} ${
            antalMandater === 1 ? "mandat" : "mandater"
          }</div>
          `;

          partiGruppe.appendChild(partiHeader);

          // Sorter kandidater efter stemmer
          const sorteredeKandidater = [...parti.candidates].sort(
            (a, b) => (b.votes || 0) - (a.votes || 0)
          );

          // Opret elementer for hver kandidat
          sorteredeKandidater.forEach((kandidat, j) => {
            // Simplificeret håndtering af billede-URL
            let imageUrl = "";
            if (kandidat.imageURL) {
              // Tag bare den første URL fra srcset
              const firstUrl = kandidat.imageURL.split(",")[0].trim();
              // Mønstergenkendelse baseret på din beskrivelse af URL-strukturen
              if (firstUrl.includes("?")) {
                // Brug hele url op til første parameter
                imageUrl = firstUrl.split(" ")[0].trim();
              }
            }

            // Opret kandidat-element
            const kandidatEl = document.createElement("div");
            kandidatEl.className = "kandidat";

            // Tjek om dette er borgmesteren baseret på data.mayor
            let erBorgmester = false;
            if (data.mayor && Object.keys(data.mayor).length > 0) {
              if (data.mayor.externalId && kandidat.externalId) {
                // Match på externalId hvis det findes
                erBorgmester = data.mayor.externalId === kandidat.externalId;
              } else if (data.mayor.name && kandidat.name) {
                // Fallback til at matche på navn
                erBorgmester = data.mayor.name === kandidat.name;
              }
            }

            if (erBorgmester) {
              kandidatEl.classList.add("borgmester");
            }

            // Initialerne hvis vi ikke har et billede
            const initialer = kandidat.name
              ? kandidat.name
                  .split(" ")
                  .map((n) => n[0])
                  .join("")
                  .substring(0, 2)
              : "?";

            kandidatEl.innerHTML = `
              <div class="kandidat-foto" style="${
                imageUrl ? `background-image: url('${imageUrl}')` : ""
              }">${!imageUrl ? initialer : ""}</div>
              <div class="kandidat-info">
                <div class="kandidat-navn">${kandidat.name || "Ukendt"}</div>
                <div class="kandidat-detaljer">${
                  kandidat.age ? `${kandidat.age} år` : ""
                }</div>
              </div>
              <div class="kandidat-stemmer">${formatNumber(
                kandidat.votes || 0
              )}</div>
            `;

            partiGruppe.appendChild(kandidatEl);
          });

          container.appendChild(partiGruppe);
        });

        // Opdater tidsstempel
        if (data.lastUpdated) {
          const dato = new Date(data.lastUpdated);
          el(
            "opdateretTid"
          ).textContent = `Sidst opdateret: ${dato.toLocaleTimeString(
            "da-DK"
          )}`;
        } else {
          el("opdateretTid").textContent = "";
        }

        // Skjul loading-skærm
        el("loadingScreen").style.display = "none";
      }

      /**
       * Lyt efter postMessage events fra kontrolpanelet
       */
      window.addEventListener("message", function (event) {
        // Tjek om beskeden kommer fra en betroet kilde (kan tilpasses)
        // if (event.origin !== "http://din-betroede-domæne.dk") return;

        if (event.data?.action === "skiftKommune") {
          // Få fat i kommune-navn til transition
          const nyKommuneId = event.data.kommuneId;
          const kommune = kommuner.find((k) => k.id === nyKommuneId) || {
            navn: "Ukendt kommune",
          };

          // Vis kommune-transitions animation
          visKommuneTransition(kommune.navn);

          // Fade-out effekt før vi skifter kommune
          const fadeEl = document.getElementById("fadeOverlay");
          fadeEl.style.opacity = "1"; // Fade out

          // Skift kommune efter fade-out
          setTimeout(() => {
            kommuneId = nyKommuneId;
            lastData = null; // Nulstil sidste data så vi får fuld opdatering
            kommuneData = null; // Nulstil kommunedata
            hentKandidatData();

            // Fade in igen efter nyt data er hentet
            setTimeout(() => {
              fadeEl.style.opacity = "0";
            }, 100);
          }, 700);
        } else if (event.data?.action === "opdaterData") {
          // Direkte opdatering med data leveret i beskeden
          visKandidatData(event.data.payload);
          lastData = event.data.payload;

          // Vis opdateringseffekt
          visDataUpdateEffect();
        } else if (event.data?.action === "genindlæs") {
          // Genindlæs hele siden
          location.reload();
        }
      });

      // Definitioner til at understøtte overgange mellem kommuner
      const kommuner = [
        { id: "810", navn: "Brønderslev" },
        { id: "813", navn: "Frederikshavn" },
        { id: "820", navn: "Vesthimmerlands" },
        { id: "825", navn: "Læsø" },
        { id: "840", navn: "Rebild" },
        { id: "846", navn: "Mariagerfjord" },
        { id: "849", navn: "Jammerbugt" },
        { id: "851", navn: "Aalborg" },
        { id: "860", navn: "Hjørring" },
      ];

      // Nedtællingstimer til næste opdatering
      const refreshInterval = 30; // sekunder
      let sekunderTilOpdatering = refreshInterval;

      // Opdater nedtælling hvert sekund
      setInterval(() => {
        sekunderTilOpdatering--;
        if (sekunderTilOpdatering <= 0) {
          sekunderTilOpdatering = refreshInterval;

          // Vis "opdaterer..." når tiden er ude
          el("nedtaelling").innerHTML = `
            <svg class="update-icon pulse" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C15.73 20 18.84 17.45 19.73 14H17.65C16.83 16.33 14.61 18 12 18C8.69 18 6 15.31 6 12C6 8.69 8.69 6 12 6C13.66 6 15.14 6.69 16.22 7.78L13 11H20V4L17.65 6.35Z"/>
            </svg>
            Opdaterer data...
          `;
        } else {
          // Opdater normal nedtælling
          el("nedtaelling").innerHTML = `
            <svg class="update-icon ${
              sekunderTilOpdatering <= 5 ? "pulse" : ""
            }" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4C7.58 4 4 7.58 4 12C4 16.42 7.58 20 12 20C15.73 20 18.84 17.45 19.73 14H17.65C16.83 16.33 14.61 18 12 18C8.69 18 6 15.31 6 12C6 8.69 8.69 6 12 6C13.66 6 15.14 6.69 16.22 7.78L13 11H20V4L17.65 6.35Z"/>
            </svg>
            Opdaterer om: ${sekunderTilOpdatering} sek
          `;
        }
      }, 1000);

      // Hent nye data med jævne mellemrum
      setInterval(() => {
        // Brug subtil opdatering
        hentKandidatData(false);
        sekunderTilOpdatering = refreshInterval;
      }, refreshInterval * 1000);

      // Initialiser siden
      hentKandidatData(true);
    </script>
    <div id="fadeOverlay"></div>
  </body>
</html>
